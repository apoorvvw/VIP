<!DOCTYPE html>
<html>
    <head>
        <title>Simple Stacked Bar Chart</title>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>     
        <style>
            svg {
                border: solid 1px #ccc;
                font: 10px sans-serif;
                shape-rendering: crispEdges;
            }


.chart text {
  fill: white;
  font: 10px sans-serif;
  text-anchor: end;
}


</style>             
</head>

<body>
        
<div>
<h2>Options: 197,198,200,213,216,218,219,222,229 </h2>
<input type="text" id="id1">
<input id="Search_btn" type="button" value="Add column" onclick="createChart(this.id);" />
<input id="Remove_btn" type="button"value="Remove column" onclick="createChart(this.id);" />
<input id="Add_Single" type="button"value="View Records" onclick="location.href='http://web.ics.purdue.edu/~awairaga/index.html';"/>
<br>
<p> Click "Add Column" button to display chart</p>
</div>
<br></br>
<div id="viz"></div>


<script type="text/javascript">
  
  // GLOBAL VARIABLES    
  var w = 960,
  h = 500,
  input_data, org_data, selected ;

  x = d3.scale.ordinal().rangeRoundBands([0, w-50])
  y = d3.scale.linear().range([0, h-50])
  var color = d3.scale.ordinal().range(['rgb(84,48,5)','rgb(140,81,10)','rgb(191,129,45)','rgb(223,194,125)','rgb(199,234,229)','rgb(128,205,193)','rgb(53,151,143)','rgb(1,102,94)','rgb(0,60,48)','rgb(103,0,31)','rgb(178,24,43)','rgb(214,96,77)','rgb(244,165,130)','rgb(209,229,240)','rgb(146,197,222)','rgb(67,147,195)','rgb(33,102,172)','rgb(5,48,97)','rgb(64,0,75)','rgb(118,42,131)','rgb(153,112,171)','rgb(194,165,207)','rgb(231,212,232)','rgb(135,135,135)','rgb(77,77,77)','rgb(26,26,26)','rgb(2,129,138)','rgb(1,108,89)','rgb(1,70,54)'])

  var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom");
  var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .tickFormat(d3.format(".2s"));

  var margin = {
  top: 20,
  right: 20,
  bottom: 30,
  left: 40
  },
  width = 1300 - margin.left - margin.right,
  height = 500 - margin.top - margin.bottom;

  var x = d3.scale.ordinal().rangeRoundBands([0, width - 300], .1);
  var y = d3.scale.linear().rangeRound([height, 0]);
  
  // create canvas
  /*var svg = d3.select("#viz").append("svg:svg")
                .attr("class", "chart")
                .attr("width", w)
                .attr("height", h )
                .append("svg:g")
                .attr("transform", "translate(10,470)");
  */

  var svg = //d3.select("body").append("svg")
            d3.select("#viz").append("svg:svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


  /********************************************
  *
  * Description: Download file and save it 
  *              in a global variable
  *
  ********************************************/
  $(document).ready(function() {
    //read data from CSV file
    $.ajax({
      type: "GET",
      url: "crunchbase-quarters1.csv",
      async: false,
      dataType: "text",
      success:  loadData()
    })
  });
  /********************************************
  *
  * Description: Download file and save it 
  *              in a global variable
  *
  ********************************************/
  function loadData(){
      d3.csv("crunchbase-quarters1.csv", function(error,dataset) {
          org_data = dataset;
          input_data = org_data;
          if (error) throw error; 
      });
  }

  /********************************************
  *
  * Description: Download file and save it 
  *              in a global variable
  *
  ********************************************/
  function createChart(id) {
    console.log("--------- ORIGINAL DATA ---------")
    console.log(org_data);

    color.domain(d3.keys(org_data[0]).filter(function(key) {
          return key !== "ID";
        }));
    
    var xAxis = d3.svg.axis()
                    .scale(x)
                    .orient("bottom");
    
    var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient("left")
                    .tickFormat(d3.format(".2s"));

    // Map the data to individual rectangles for the stacked bar
    org_data.forEach(function(d) {
      var y0 = 0;
      d.crimes = color.domain().map(function(name) {
        return {
          name: name, // Name of the crime
          y0: y0,     // Lower bound for the individual rectangle for the given crime
          y1: y0 += +d[name]  // Upper bound.
        };
      });
      d.total = d.crimes[d.crimes.length - 1].y1; // To keep track of the total height of the bar
    });        

    // May be sort to make it look nicer
    //org_data.sort(function(a, b) { return b.total - a.total; });

    //Marking the domain of the graph
    x.domain( org_data.map(function(d) {  // x domain is all IDs
      return d.ID; 
    }));
    y.domain([0, d3.max(data, function(d) { // Y domain is 0 to sum of all crimes for that ID, which is stores in d.Total for all the IDs
      return d.total; 
    })]);

    


  }
  /********************************************
  *
  * Description: Download file and save it 
  *              in a global variable
  *
  ********************************************/
  function addCols (mat) {

      /* ...
         body
      ...*/

      return mat;           
  }
  /********************************************
  *
  * Description: Download file and save it 
  *              in a global variable
  *
  ********************************************/
  function doFunction() {
      if(d3.select('table')[0][0] != null){
       d3.select('table').remove();
      }            
      var newArr = [];
      //alert(document.getElementById("id1").value);
      d3.text("crunchbase-quarters1.csv", function(datasetText) {

          parsedCSV = d3.csv.parseRows(datasetText);
          var row0 = parsedCSV[0][0]
          var len = parsedCSV.length
          /************************************************************************/

          // Create a table using d3js

          /************************************************************************/
          var i = 0 , loc = 0, c = 1;

          newArr[0] = parsedCSV[0];
          for ( i = 0 ; i<len ; i++) {
            //console.log(parsedCSV[i][0] + "  " + document.getElementById("id1").value);
            if ( parsedCSV[i][0] == document.getElementById("id1").value) {
              //alert("Found :" + i);
              newArr[c] = parsedCSV[i];
              c++;
              break;
            }
          }
          //console.log(newArr)
          sampleHTML = d3.select("body")
              .append("table")
              .style("border-collapse", "collapse")
              .style("border", "2px black solid")
              .style("background-color", "white")
              .selectAll("tr")
              .data(newArr)
              .enter().append("tr")

              .selectAll("td")
              .data(function(d) {
                  return d;
              })
              .enter().append("td")
              .style("border", "1px black solid")
              .style("padding", "5px")
              .style("background-color", "white")
              .on("mouseover", function() {
                  d3.select(this)
                      .transition()
                      .delay(0)
                      .duration(300)
                      .style("background-color", "cyan");
              })
              .on("mouseout", function() {
                  d3.select(this)
                      .transition()
                      .delay(0)
                      .duration(600)
                      .style("background-color", "white");
              })
              .text(function(d) {
                  return d;
              })
              .style("font-size", "12px");
            }); 



console.log(newArr);
var data = [4, 8, 15, 16, 23, 42];

var width = 420,
    barHeight = 20;

var x = d3.scale.linear()
    .domain([0, d3.max(data)])
    .range([0, width]);

var chart = d3.select(".chart")
    .attr("width", width)
    .attr("height", barHeight * data.length);

var bar = chart.selectAll("g")
    .data(data)
  .enter().append("g")
    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

bar.append("rect")
    .attr("width", x)
    .attr("height", barHeight - 1);

bar.append("text")
    .attr("x", function(d) { return x(d) - 3; })
    .attr("y", barHeight / 2)
    .attr("dy", ".35em")
    .text(function(d) { return d; });
  }
        </script>

      <svg class="chart"></svg>
    </body>
</html>
